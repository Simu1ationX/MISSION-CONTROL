<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mission Control</title>
  <style>
    :root{
      --bg:#05070a;
      --panel:#0b0f16;
      --text:#e9eef7;
      --muted:#9aa7bd;

      /* Mode accents (will be overwritten by JS) */
      --accent:#00b7ff;     /* electric blue */
      --accent2:#00ffd5;    /* cyan */
      --danger:#ff2e2e;     /* tactical red */
      --glow: rgba(0,183,255,.35);
      --border: rgba(0,183,255,.35);
    }

    *{box-sizing:border-box}
    html,body{height:100%; margin:0; background:var(--bg); color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;}
    body{overflow:hidden}

    .wrap{
      display:grid;
      grid-template-rows: 22vh 33vh 45vh; /* top / middle / charts */
      height:100vh;
      gap:12px;
      padding:12px;
    }

    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border:1px solid var(--border);
      border-radius:14px;
      box-shadow: 0 0 0 1px rgba(255,255,255,.02) inset, 0 0 28px rgba(0,0,0,.55);
      overflow:hidden;
      position:relative;
    }

    /* Neon edge glow */
    .panel:before{
      content:"";
      position:absolute; inset:-2px;
      border-radius:16px;
      pointer-events:none;
      box-shadow: 0 0 32px var(--glow);
      opacity:.65;
    }

    /* Header (Top) */
    .top{
      display:grid;
      grid-template-columns: 1.2fr 1.6fr 1.2fr;
      gap:12px;
      padding:14px;
    }

    .brand{
      padding:16px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:6px;
    }
    .brand .tag{
      color:var(--muted);
      letter-spacing:.12em;
      text-transform:uppercase;
      font-weight:700;
      font-size:12px;
    }
    .brand .title{
      font-size:26px;
      font-weight:800;
      letter-spacing:.02em;
      line-height:1.05;
    }
    .brand .mode{
      margin-top:8px;
      display:inline-flex;
      align-items:center;
      gap:10px;
      font-weight:700;
      color:var(--muted);
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background:var(--accent);
      box-shadow:0 0 12px var(--accent);
    }

    .clock{
      padding:16px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      text-align:center;
      gap:10px;
    }
    .clock .time{
      font-size:64px;
      font-weight:900;
      letter-spacing:.02em;
      text-shadow: 0 0 18px var(--glow);
    }
    .clock .date{
      color:var(--muted);
      font-size:18px;
      font-weight:700;
      letter-spacing:.06em;
      text-transform:uppercase;
    }

    .countdown{
      padding:16px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:flex-end;
      text-align:right;
      gap:10px;
    }
    .countdown .label{
      color:var(--muted);
      font-weight:800;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:12px;
    }
    .countdown .to{
      font-size:22px;
      font-weight:900;
      color:var(--text);
    }
    .countdown .timer{
      font-size:44px;
      font-weight:950;
      letter-spacing:.04em;
      color:var(--accent);
      text-shadow: 0 0 18px var(--glow);
    }
    .countdown .hint{
      color:var(--muted);
      font-weight:700;
      font-size:12px;
    }

    /* Middle row */
    .mid{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
      padding:12px;
    }

    .box{
      height:100%;
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .h{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .h .label{
      color:var(--muted);
      letter-spacing:.12em;
      text-transform:uppercase;
      font-weight:900;
      font-size:12px;
    }
    .h .pill{
      border:1px solid var(--border);
      color:var(--accent);
      padding:6px 10px;
      border-radius:999px;
      font-weight:900;
      font-size:12px;
      box-shadow:0 0 18px rgba(0,0,0,.35);
    }

    .list{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:6px;
    }
    .item{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:12px;
      background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.05);
    }
    .item input[type="checkbox"]{
      transform:scale(1.25);
      accent-color: var(--accent);
    }
    .item input[type="text"]{
      width:100%;
      border:none;
      outline:none;
      background:transparent;
      color:var(--text);
      font-size:16px;
      font-weight:700;
    }

    textarea{
      width:100%;
      height:100%;
      min-height:160px;
      resize:none;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.07);
      background:rgba(0,0,0,.22);
      color:var(--text);
      padding:12px;
      font-size:14px;
      line-height:1.35;
      font-weight:650;
      outline:none;
    }
    textarea:focus{ border-color: var(--border); box-shadow: 0 0 0 2px rgba(0,0,0,.2), 0 0 18px var(--glow); }

    .riskgrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:6px;
    }
    .stat{
      padding:12px;
      border-radius:12px;
      background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.06);
    }
    .stat .k{
      color:var(--muted);
      font-weight:900;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:11px;
    }
    .stat input{
      margin-top:6px;
      width:100%;
      border:none;
      outline:none;
      background:transparent;
      color:var(--text);
      font-size:22px;
      font-weight:950;
    }

    /* Charts row */
    .charts{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
      padding:12px;
    }
    .chart{
      padding:0;
      display:flex;
      flex-direction:column;
    }
    .chartHead{
      padding:10px 12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:1px solid rgba(255,255,255,.06);
      background:rgba(0,0,0,.18);
    }
    .chartHead .tf{
      font-weight:950;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:var(--accent);
      text-shadow: 0 0 16px var(--glow);
    }
    .chartBody{
      flex:1;
      min-height:0;
    }

    /* Session closed overlay */
    .closed{
      position:absolute;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,.68);
      backdrop-filter: blur(6px);
      z-index:5;
    }
    .closed .msg{
      text-align:center;
      padding:26px 30px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(10,14,20,.78);
      box-shadow: 0 0 40px rgba(0,0,0,.6);
    }
    .closed .msg .big{
      font-size:44px;
      font-weight:1000;
      letter-spacing:.10em;
      text-transform:uppercase;
      color:var(--muted);
    }
    .closed .msg .small{
      margin-top:10px;
      color:var(--muted);
      font-weight:750;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:12px;
    }

    /* Make it TV-friendly */
    @media (max-width: 1100px){
      .wrap{grid-template-rows: auto auto auto; height:auto; overflow:auto}
      body{overflow:auto}
      .top,.mid,.charts{grid-template-columns: 1fr}
      .clock .time{font-size:52px}
    }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- TOP ROW -->
    <div class="top panel">
      <div class="brand">
        <div class="tag">Neon Elite • War Room Tactical</div>
        <div class="title">MISSION CONTROL</div>
        <div class="mode">
          <span class="dot" id="modeDot"></span>
          <span id="modeText">Morning Mode</span>
        </div>
      </div>

      <div class="clock">
        <div class="time" id="time">--:--</div>
        <div class="date" id="date">---</div>
      </div>

      <div class="countdown">
        <div class="label">Countdown to OPEN</div>
        <div class="to">07:30 MT</div>
        <div class="timer" id="cd">--:--:--</div>
        <div class="hint">Red begins at 07:15 • Session ends 11:00</div>
      </div>
    </div>

    <!-- MIDDLE ROW -->
    <div class="mid">
      <div class="panel box">
        <div class="h">
          <div class="label">Today’s Top 3</div>
          <div class="pill">LOCK IN</div>
        </div>
        <div class="list" id="top3">
          <label class="item"><input type="checkbox" data-i="0"><input type="text" placeholder="A+ setups only" data-i="0"></label>
          <label class="item"><input type="checkbox" data-i="1"><input type="text" placeholder="Workout / mobility" data-i="1"></label>
          <label class="item"><input type="checkbox" data-i="2"><input type="text" placeholder="Instacart / business target" data-i="2"></label>
        </div>
      </div>

      <div class="panel box">
        <div class="h">
          <div class="label">Rules of Engagement</div>
          <div class="pill" id="rulePill">A+ ONLY</div>
        </div>
        <textarea id="rules" spellcheck="false"></textarea>
      </div>

      <div class="panel box">
        <div class="h">
          <div class="label">Risk & Money Control</div>
          <div class="pill">NO OVERTRADE</div>
        </div>
        <div class="riskgrid">
          <div class="stat">
            <div class="k">Daily Max Risk</div>
            <input id="maxRisk" placeholder="$___" />
          </div>
          <div class="stat">
            <div class="k">Daily Target</div>
            <input id="dayTarget" placeholder="$___" />
          </div>
          <div class="stat">
            <div class="k">Weekly Target</div>
            <input id="weekTarget" placeholder="$____" />
          </div>
          <div class="stat">
            <div class="k">Weekly Progress</div>
            <input id="weekProg" placeholder="$____" />
          </div>
        </div>
      </div>
    </div>

    <!-- CHARTS ROW -->
    <div class="panel chart">
      <div class="closed" id="closedOverlay">
        <div class="msg">
          <div class="big">SESSION CLOSED</div>
          <div class="small">Reset • Review • Recovery • No More Hunting</div>
        </div>
      </div>

      <div class="charts">
        <div class="panel chart">
          <div class="chartHead"><div class="tf">MNQ • 5m</div><div class="tf" style="color:var(--muted); text-shadow:none;">MNQ1!</div></div>
          <div class="chartBody" id="tv_5m"></div>
        </div>
        <div class="panel chart">
          <div class="chartHead"><div class="tf">MNQ • 1H</div><div class="tf" style="color:var(--muted); text-shadow:none;">MNQ1!</div></div>
          <div class="chartBody" id="tv_1h"></div>
        </div>
        <div class="panel chart">
          <div class="chartHead"><div class="tf">MNQ • 4H</div><div class="tf" style="color:var(--muted); text-shadow:none;">MNQ1!</div></div>
          <div class="chartBody" id="tv_4h"></div>
        </div>
      </div>
    </div>

  </div>

  <!-- TradingView embed -->
  <script src="https://s3.tradingview.com/tv.js"></script>

  <script>
    // ====== SETTINGS YOU CAN EDIT ======
    const TZ = "America/Denver";      // Mountain Time
    const OPEN_HH = 7, OPEN_MM = 30;  // 7:30 MT open
    const PREOPEN_MIN = 15;           // red starts 15 min before open
    const CUTOFF_HH = 11, CUTOFF_MM = 0; // 11:00 MT session close

    // TradingView symbol (futures continuous)
    const SYMBOL = "CME_MINI:MNQ1!"; // you can change if needed

    // ====== UI STATE ======
    const els = {
      time: document.getElementById("time"),
      date: document.getElementById("date"),
      cd: document.getElementById("cd"),
      modeText: document.getElementById("modeText"),
      modeDot: document.getElementById("modeDot"),
      rulePill: document.getElementById("rulePill"),
      rules: document.getElementById("rules"),
      closedOverlay: document.getElementById("closedOverlay"),
    };

    // ====== LOCAL STORAGE (editable rules + top3 + money) ======
    const LS_KEY = "mission_control_v1";

    const defaultRules =
`SESSION: 07:30–11:00 MT
A+ SETUPS ONLY
ENTRY: Pullback + Reclaim
CONFIRM: VWAP + 9/21 aligned
STOP: Defined before entry
NO CHASE • NO REVENGE
HIT TARGET → DONE`;

    function loadState(){
      const raw = localStorage.getItem(LS_KEY);
      let st = raw ? JSON.parse(raw) : {};
      if (!st.rules) st.rules = defaultRules;
      if (!st.top3) st.top3 = [
        {text:"A+ setups only", done:false},
        {text:"Workout / mobility", done:false},
        {text:"Instacart / business target", done:false},
      ];
      if (!st.money) st.money = {maxRisk:"", dayTarget:"", weekTarget:"", weekProg:""};
      return st;
    }

    function saveState(st){
      localStorage.setItem(LS_KEY, JSON.stringify(st));
    }

    let STATE = loadState();

    function bindEditable(){
      // Rules
      els.rules.value = STATE.rules;
      els.rules.addEventListener("input", () => {
        STATE.rules = els.rules.value;
        saveState(STATE);
      });

      // Money inputs
      const moneyIds = ["maxRisk","dayTarget","weekTarget","weekProg"];
      moneyIds.forEach(id=>{
        const el = document.getElementById(id);
        el.value = STATE.money[id] || "";
        el.addEventListener("input", ()=>{
          STATE.money[id] = el.value;
          saveState(STATE);
        });
      });

      // Top 3
      const top3 = document.getElementById("top3");
      top3.querySelectorAll('input[type="text"]').forEach(input=>{
        const i = Number(input.dataset.i);
        input.value = STATE.top3[i]?.text ?? "";
        input.addEventListener("input", ()=>{
          STATE.top3[i].text = input.value;
          saveState(STATE);
        });
      });
      top3.querySelectorAll('input[type="checkbox"]').forEach(cb=>{
        const i = Number(cb.dataset.i);
        cb.checked = !!STATE.top3[i]?.done;
        cb.addEventListener("change", ()=>{
          STATE.top3[i].done = cb.checked;
          saveState(STATE);
        });
      });
    }

    // ====== TIME HELPERS (Mountain Time) ======
    function nowInTZ(){
      // Use Intl to get parts in desired timezone
      const dt = new Date();
      const parts = new Intl.DateTimeFormat("en-US", {
        timeZone: TZ,
        year:"numeric", month:"2-digit", day:"2-digit",
        hour:"2-digit", minute:"2-digit", second:"2-digit",
        hour12:false
      }).formatToParts(dt).reduce((acc,p)=> (acc[p.type]=p.value, acc), {});
      // Build a Date-like object with those parts (in local JS it’s "naive", but good enough for diffs)
      return {
        y:+parts.year, mo:+parts.month, d:+parts.day,
        hh:+parts.hour, mm:+parts.minute, ss:+parts.second
      };
    }

    function asMs(t){
      // Convert tz parts to a timestamp by creating a Date in UTC with those components,
      // then comparing in same constructed space. This works for daily scheduling.
      return Date.UTC(t.y, t.mo-1, t.d, t.hh, t.mm, t.ss || 0);
    }

    function buildTodayAt(hh, mm){
      const n = nowInTZ();
      return {y:n.y, mo:n.mo, d:n.d, hh, mm, ss:0};
    }

    function pad2(n){ return String(n).padStart(2,"0"); }

    // ====== MODE LOGIC ======
    function applyMode(mode){
      // Modes: MORNING, PREOPEN, SESSION, CLOSED
      const root = document.documentElement;

      if (mode === "PREOPEN"){
        root.style.setProperty("--accent", "#ff2e2e");
        root.style.setProperty("--glow", "rgba(255,46,46,.35)");
        root.style.setProperty("--border", "rgba(255,46,46,.38)");
        els.modeText.textContent = "Pre-Open Mode";
        els.rulePill.textContent = "LOCKED";
        els.rulePill.style.color = "var(--danger)";
        els.modeDot.style.background = "var(--danger)";
        els.modeDot.style.boxShadow = "0 0 12px var(--danger)";
        els.closedOverlay.style.display = "none";
        return;
      }

      if (mode === "CLOSED"){
        // calm blue but overlay session closed
        root.style.setProperty("--accent", "#00b7ff");
        root.style.setProperty("--glow", "rgba(0,183,255,.26)");
        root.style.setProperty("--border", "rgba(0,183,255,.25)");
        els.modeText.textContent = "Post-Session";
        els.rulePill.textContent = "STAND DOWN";
        els.rulePill.style.color = "var(--muted)";
        els.modeDot.style.background = "var(--muted)";
        els.modeDot.style.boxShadow = "none";
        els.closedOverlay.style.display = "flex";
        return;
      }

      if (mode === "SESSION"){
        root.style.setProperty("--accent", "#00b7ff");
        root.style.setProperty("--glow", "rgba(0,183,255,.35)");
        root.style.setProperty("--border", "rgba(0,183,255,.35)");
        els.modeText.textContent = "Session Mode";
        els.rulePill.textContent = "EXECUTE";
        els.rulePill.style.color = "var(--accent)";
        els.modeDot.style.background = "var(--accent)";
        els.modeDot.style.boxShadow = "0 0 12px var(--accent)";
        els.closedOverlay.style.display = "none";
        return;
      }

      // MORNING
      root.style.setProperty("--accent", "#00b7ff");
      root.style.setProperty("--glow", "rgba(0,183,255,.28)");
      root.style.setProperty("--border", "rgba(0,183,255,.28)");
      els.modeText.textContent = "Morning Mode";
      els.rulePill.textContent = "READY";
      els.rulePill.style.color = "var(--accent)";
      els.modeDot.style.background = "var(--accent)";
      els.modeDot.style.boxShadow = "0 0 12px var(--accent)";
      els.closedOverlay.style.display = "none";
    }

    function getMode(){
      const n = nowInTZ();
      const nowMs = asMs(n);

      const open = buildTodayAt(OPEN_HH, OPEN_MM);
      const preopen = buildTodayAt(OPEN_HH, OPEN_MM);
      // subtract PREOPEN_MIN minutes
      preopen.mm -= PREOPEN_MIN;
      if (preopen.mm < 0){ preopen.mm += 60; preopen.hh -= 1; }

      const cutoff = buildTodayAt(CUTOFF_HH, CUTOFF_MM);

      const openMs = asMs(open);
      const preMs = asMs(preopen);
      const cutMs = asMs(cutoff);

      if (nowMs >= cutMs) return "CLOSED";
      if (nowMs >= openMs) return "SESSION";
      if (nowMs >= preMs) return "PREOPEN";
      return "MORNING";
    }

    // ====== CLOCK + COUNTDOWN ======
    function tick(){
      const n = nowInTZ();

      // time + date
      const hh12 = ((n.hh + 11) % 12) + 1;
      const ampm = n.hh >= 12 ? "PM" : "AM";
      els.time.textContent = `${pad2(hh12)}:${pad2(n.mm)}:${pad2(n.ss)} ${ampm}`;

      const dateStr = new Intl.DateTimeFormat("en-US", {
        timeZone: TZ, weekday:"long", month:"long", day:"numeric"
      }).format(new Date());
      els.date.textContent = dateStr.toUpperCase();

      // countdown to open
      const open = buildTodayAt(OPEN_HH, OPEN_MM);
      const nowMs = asMs(n);
      let diff = asMs(open) - nowMs;

      if (diff < 0) diff = 0;

      const h = Math.floor(diff / 3600000);
      diff -= h * 3600000;
      const m = Math.floor(diff / 60000);
      diff -= m * 60000;
      const s = Math.floor(diff / 1000);

      els.cd.textContent = `${pad2(h)}:${pad2(m)}:${pad2(s)}`;

      // mode update
      const mode = getMode();
      applyMode(mode);
    }

    // ====== TRADINGVIEW CHARTS ======
    function buildChart(containerId, interval){
      return new TradingView.widget({
        container_id: containerId,
        autosize: true,
        symbol: SYMBOL,
        interval: interval,
        timezone: TZ,
        theme: "dark",
        style: "1",
        locale: "en",
        allow_symbol_change: false,
        enable_publishing: false,
        hide_top_toolbar: true,
        hide_side_toolbar: true,
        hide_legend: true,
        hide_volume: true,
        withdateranges: false,
        save_image: false,
        studies: [],  // keep it clean; indicators via TradingView may be limited in embed
        overrides: {
          "paneProperties.background": "#05070a",
          "paneProperties.vertGridProperties.color": "rgba(255,255,255,0.04)",
          "paneProperties.horzGridProperties.color": "rgba(255,255,255,0.04)",
          "scalesProperties.textColor": "rgba(233,238,247,0.65)",
          "mainSeriesProperties.candleStyle.upColor": "#14f195",
          "mainSeriesProperties.candleStyle.downColor": "#ff2e2e",
          "mainSeriesProperties.candleStyle.wickUpColor": "#14f195",
          "mainSeriesProperties.candleStyle.wickDownColor": "#ff2e2e",
          "mainSeriesProperties.candleStyle.borderUpColor": "#14f195",
          "mainSeriesProperties.candleStyle.borderDownColor": "#ff2e2e"
        }
      });
    }

    function initCharts(){
      buildChart("tv_5m", "5");
      buildChart("tv_1h", "60");
      buildChart("tv_4h", "240");
    }

    // ====== INIT ======
    bindEditable();
    initCharts();
    tick();
    setInterval(tick, 1000);
  </script>
</body>
</html>
